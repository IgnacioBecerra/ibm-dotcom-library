import { Preview, Props, Description, Story } from '@storybook/addon-docs/blocks';
import contributing from '../../../../../../docs/contributing-license.md';
import { cdnJs, cdnCss } from '../../../globals/internal/storybook-cdn';



# Masthead

> The masthead component is a required navigational pattern for IBM.com that
> displays consistently at the top of each page. It also includes search and
> profile services for IBM.com.

> ðŸ’¡ Check our
> [CodeSandbox](https://githubbox.com/carbon-design-system/carbon-for-ibm-dotcom/tree/master/packages/web-components/examples/codesandbox/components/masthead)
> example implementation.

### Masthead (L0):

[![Edit @carbon/ibmdotcom-web-components](https://codesandbox.io/static/img/play-codesandbox.svg)](https://githubbox.com/carbon-design-system/carbon-for-ibm-dotcom/tree/master/packages/web-components/examples/codesandbox/components/masthead)

### Masthead (L1):

[![Edit @carbon/ibmdotcom-web-components](https://codesandbox.io/static/img/play-codesandbox.svg)](https://githubbox.com/carbon-design-system/carbon-for-ibm-dotcom/tree/master/packages/web-components/examples/codesandbox/components/masthead-l1)

## Getting Started
##### Note: Masthead uses the Carbon White theme by design. Using other themes will not change the Masthead color scheme.

### JS (via import)

```javascript
import '@carbon/ibmdotcom-web-components/es/components/masthead/masthead-container.js';
```

<Description markdown={`${cdnJs({ components: ['masthead'] })}`} />

<Description markdown={`${cdnCss()}`} />

### HTML

```html
<dds-masthead-container></dds-masthead-container>
```

#### Setting Platform

```html
<dds-masthead-container platform="Lorem Ipsum"></dds-masthead-container>
```

#### Setting Platform URL

The `platformUrl` property accepts a single URL as string or an object with a specific URL for each locale.

###### Setting a single platform URL:

```html
<dds-masthead-container platform="Lorem Ipsum" .platformUrl="${`https://www.example.com`}"></dds-masthead-container>
```

###### Setting multiple platform URLs with an object:

With an object, the component will show a specific URL depending on the locale:

```javascript
const urlObject = {
  'en-US': {
    url: 'https://www.example.com',
  },
  'fr-FR': {
    url: 'https://www.example.com/fr-fr/sample',
  },
  'es-MX': {
    url: 'https://www.example.com/es-mx/sample',
  },
};
```

```html
<dds-masthead-container platform="Lorem Ipsum" .platformUrl=${urlObject}></dds-masthead-container>
```

#### Custom Navigation

```javascript
const links = [...menu items...];
document.getElementById('masthead-container').navLinks = links;
```

#### Using L1 nav

To use L1 nav, set `l1Data` prop. `l1Data` prop should be an
object that contains the navigation data of L1 nav:

```javascipt
const l1Data = {
  platform: {
    name: 'Stock Charts',
    url: 'https://example.com/',
  },
  menuItems: (The nav links),
}
```

```html
<dds-masthead-container id="masthead-container"></dds-masthead-container>
```

To set a custom endpoint for the translation service to fetch from, set either the `data-endpoint` attribute like below or `DDS_TRANSLATION_ENDPOINT` environment variable.

```html
<dds-masthead-container data-endpoint="/custom-endpoint"></dds-masthead-container>
```

## Using custom search with typeahead API

Using a custom search API than the default provided from IBM Search is supported, as well as separating any existing groups into its separate sections.

First, pass in the `custom-typeahead-api` boolean into the Masthead.

```html
<dds-masthead-composite custom-typeahead-api="true"></dds-masthead-composite>
```

As an example, we will be using the IBM Docs API to fetch the data. 

```javascript
  async function customTypeaheadApiFunction(searchVal) {
    return await fetch(
      `https://ibmdocs-dev.mybluemix.net/docs/api/v1/suggest?query=${searchVal}&lang=undefined&categories=&limit=6`
    )
      .then((response) => response.json())
      .then((data) => {
        let searchResults = [
          data.hints,
          {
            title: "Product pages",
            items: data.products
          }
        ];
        return searchResults;
      });
  }
```

To query the current Masthead Search input, we need to create an event listener to listen for the `dds-search-with-typeahead-input` event.
Once captured, we need to call our asynchronous function to fetch the custom API results based on the query. Once the results are retrieved,
a new custom event `dds-custom-typeahead-api-results` needs to be dispatched containing the results. This is necessary for the component to
render the custom search results as well as its optional groups, if they exist.

```javascript
  document.addEventListener('dds-search-with-typeahead-input', async (e) => { 

    const results = await customTypeaheadApiFunction(e.detail.value);
    document.dispatchEvent(new CustomEvent('dds-custom-typeahead-api-results', { detail: results}));
  })
```

With these functions, the custom Search API will be working properly.

#### Note
The API results must match the following structure:
```javascript
[
  ['result 1', 'result 2', 'result 3'],
  {
    title: 'Example group 1'
    items: ['result a', 'result b', 'result c']
  },
  {
    title: "Example group 2",
    items: ['result d', 'result e', 'result f']
  }
]
```
Note that only the first Array element is necessary to render the basic search suggestions, the following JSON elements are optional Grouped sections.

## Props

### `<dds-masthead-container>`/`<dds-masthead-composite>`

<Props of="dds-masthead-composite" />

For Cloud-specific version of masthead-container, `<dds-cloud-masthead-container>`, we support two user authentication methods, via cookie or api. To select between the two, provide the `auth-method` prop with a value of either 'cookie' or 'api'.

```html
<dds-cloud-masthead-container auth-method="cookie"></dds-cloud-masthead-container>
```

## Stable selectors

See [our README](https://github.com/carbon-design-system/carbon-for-ibm-dotcom/tree/master/packages/web-components#stable-selectors-for-analytics-and-integratione2e-testing-in-web-components) to see how Web Components selector and `data-autoid` should be used.

| Web Components selector                                                                   | Compatibility selector                                                   | Description |
| ----------------------------------------------------------------------------------------- | ------------------------------------------------------------------------ | ----------- |
| `<dds-masthead>`                                                                          | `data-autoid="dds--masthead"`                                            | Component   |
| `<dds-masthead-menu-button>`                                                              | `data-autoid="dds--masthead__hamburger"`                                 | Interactive |
| `<dds-top-nav-name>`                                                                      | `data-autoid="dds--masthead__platform-name"`                             | Interactive |
| `<dds-top-nav>`                                                                           | `data-autoid="dds--masthead__l0-nav"`                                    | Component   |
| `<dds-top-nav-menu trigger-content="${item}">` and `<dds-top-nav-item title="${item}">`   | `data-autoid="dds--masthead__l0-nav--nav${item}"`                       | Interactive |
| `<dds-top-nav-menu-item title="${item}">`                                                 | `data-autoid="dds--masthead__l0-nav--subnav-col${item}-item${item}"`     | Interactive |
| `<dds-left-nav>`                                                                          | `data-autoid="dds--masthead__l0-sidenav"`                                | Component   |
| `<dds-left-nav-menu trigger-content="${item}">` and `<dds-left-nav-item title="${item}">` | `data-autoid="dds--masthead__l0-sidenav--nav${item}"`                   | Interactive |
| `<dds-left-nav-menu-item title="${item}">`                                                | `data-autoid="dds--masthead__l0-sidenav--subnav-col${item}-item${item}"` | Interactive |


<Description markdown={contributing} />
